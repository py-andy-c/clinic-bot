# Railway Config as Code
# This file configures the build and deployment for Railway
# See: https://docs.railway.com/guides/config-as-code
# Configuration defined here overrides dashboard settings

[build]
# Use Railpack (default) - Railway's modern buildpack
# Railway will auto-detect dependencies from requirements.txt
builder = "RAILPACK"

# Specify Python version and system dependencies via nixpacksPlan (Railpack respects this)
# This replaces runtime.txt for Python version specification
# WeasyPrint requires Cairo, Pango, and GDK-PixBuf system libraries
[build.nixpacksPlan]
[build.nixpacksPlan.phases]
[build.nixpacksPlan.phases.setup]
nixPkgs = ["python312", "cairo", "pango", "gdk-pixbuf"]

[deploy]
# Start command - runs migrations and starts the app via start.sh
# start.sh handles: alembic directory fix, migrations, and app startup
startCommand = "bash start.sh"

# Health check configuration
healthcheckPath = "/health"
healthcheckTimeout = 100

# Restart policy - restart on failure
restartPolicyType = "ALWAYS"

